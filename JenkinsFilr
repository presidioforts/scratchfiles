
pipeline {
    agent {
        label 'windows' // Replace with your Windows agent label
    }

    environment {
        PYTHON = 'python' // Adjust if your agent uses python3 or full path
    }

    stages {
        stage('Setup Environment') {
            steps {
                bat '''
                %PYTHON% -m venv env
                call env\\Scripts\\activate.bat
                pip install --upgrade pip setuptools wheel build
                '''
            }
        }

        stage('Download and Build Tokenizers') {
            steps {
                bat '''
                call env\\Scripts\\activate.bat
                pip download tokenizers==0.13.3 --no-binary=:all:
                tar -xvf tokenizers-0.13.3.tar.gz
                cd tokenizers-0.13.3
                %PYTHON% -m build
                copy dist\\tokenizers-0.13.3-*.whl %WORKSPACE%
                '''
            }
        }

        stage('Archive Wheel') {
            steps {
                archiveArtifacts artifacts: 'tokenizers-0.13.3-*.whl', fingerprint: true
            }
        }
    }

    post {
        always {
            echo 'Build completed. Tokenizers wheel is archived if successful.'
        }
        failure {
            echo 'Something failedâ€”check the build logs.'
        }
    }
}
